<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Dashboard - MyClass</title>
  <style>
    /* ======= General styles ======= */
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Inter',sans-serif; background: linear-gradient(to right, #667eea, #764ba2); }
    .container { display:flex; min-height:100vh; position:relative; }

    /* Navigation */
    .navbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 15px 0;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .nav-container { display: flex; align-items: center; width: 100%; padding-right: 20px; }
    .logo { font-size: 24px; font-weight: bold; color: #2c3e50; padding-left: 20px; }
    .nav-links { display: flex; gap: 30px; justify-content: flex-end; flex: 1; }
    .nav-links a { text-decoration: none; color: #2c3e50; font-weight: 500; transition: color 0.3s ease; }
    .nav-links a:hover { color: #3498db; }

    /* Sidebar */
    .sidebar {
      background: rgba(47,62,70,0.9);
      backdrop-filter: blur(20px);
      border-right:1px solid rgba(255,255,255,0.3);
      color:#fff; width:280px; padding:30px 25px; transition:0.3s;
      box-shadow:4px 0 20px rgba(0,0,0,0.2);
    }
    .sidebar h2 { text-align:center; margin-bottom:40px; font-size:26px; font-weight:700;
      background: linear-gradient(5deg, #0a43df, #d8d7e0);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .sidebar ul { list-style:none; }
    .sidebar ul li { margin:20px 0; border-radius:12px; transition:0.3s; }
    .sidebar ul li:hover { background:rgba(255,255,255,0.1); transform:translateX(5px); }
    .sidebar ul li a { color:#fff; text-decoration:none; font-weight:500; display:flex; align-items:center; padding:15px 20px; border-radius:12px; transition:0.3s; font-size:16px; }
    .sidebar ul li a span { margin-right:15px; font-size:20px; }
    .sidebar ul li a:hover { color:#fff; }

    /* Main content */
    .main-content { flex:1; padding:40px; background:rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
    .top-bar { margin-bottom:30px; }
    .welcome-section h1 { font-size:36px; color:#fff; margin-bottom:5px; }
    .welcome-section p { color:rgba(255,255,255,0.8); }

    .dashboard-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:25px; margin-bottom:40px; }
    .stat-card { background: rgba(255,255,255,0.15); padding:20px; border-radius:20px; border:1px solid rgba(255,255,255,0.2); text-align:center; }
    .stat-card h3 { color:#fff; margin-bottom:15px; }
    .stat-card .number { font-size:36px; color:#fff; font-weight:800; margin-bottom:10px; }

    .quick-actions { display:flex; flex-direction:column; gap:10px; }
    .quick-action-btn { display:inline-block; background: rgba(255,255,255,0.2); color:#fff; padding:10px 15px; border-radius:12px; text-decoration:none; transition:0.3s; }
    .quick-action-btn:hover { background: rgba(255,255,255,0.3); }

    /* Today‚Äôs Schedule Section */
    .today-section { 
      background: rgba(255,255,255,0.1); 
      backdrop-filter:blur(20px); 
      padding:35px; 
      border-radius:20px; 
      border:1px solid rgba(255,255,255,0.2); 
      box-shadow:0 10px 30px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .today-section h2 { 
      margin-bottom:25px; 
      color:#fff; 
      font-size:24px; 
      font-weight:700; 
      display:flex; 
      align-items:center;
      background: linear-gradient(45deg, #ff6b6b, #ffd89b);
      -webkit-background-clip: text; 
      -webkit-text-fill-color: transparent; 
      background-clip: text;
    }
    .today-section h2 span { margin-right:15px; font-size:28px; }

    .today-classes { display: grid; gap: 15px; }

    .today-class-item {
      background: linear-gradient(135deg, rgba(255,107,107,0.2), rgba(255,216,155,0.2));
      border-radius: 15px;
      padding: 20px;
      border: 2px solid rgba(255,107,107,0.3);
      position: relative;
      transition: all 0.3s ease;
    }

    .current-class { background: linear-gradient(135deg, rgba(46,204,113,0.2), rgba(52,152,219,0.2)) !important; border-color: rgba(46,204,113,0.4) !important; }
    .next-class { background: linear-gradient(135deg, rgba(155,89,182,0.2), rgba(142,68,173,0.2)) !important; border-color: rgba(155,89,182,0.4) !important; }

    .class-time-today, .class-subject-today, .class-room-today { color:#fff; margin-bottom:5px; }
    .class-status { display:inline-block; padding:5px 12px; border-radius:20px; font-size:12px; font-weight:600; text-transform:uppercase; }
    .status-current { background: rgba(46,204,113,0.3); color:#2ecc71; }
    .status-next { background: rgba(155,89,182,0.3); color:#9b59b6; }
    .status-upcoming { background: rgba(255,107,107,0.3); color:#ff6b6b; }

    /* Responsive */
    @media(max-width:768px) { .container{flex-direction:column;} .sidebar{width:100%;padding:20px;} .main-content{padding:20px;} .dashboard-grid{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="logo">üéØ MyClass</div>
      <div class="nav-links">
        <a href="#home">Home</a>
        <a href="#profile">Profile</a>
        <a href="#courses">Courses</a>
        <a href="#help">Help</a>
      </div>
    </div>
  </nav>

  <div class="container">
    <aside class="sidebar">
      <div class="sidebar-header"><h2>üéì MyClass</h2></div>
      <ul>
        <li class="active"><a href="#"><span>üè†</span> Dashboard</a></li>
        <li><a href="student_courses.html"><span>üìö</span> My Courses</a></li>
        <li><a href="Student_Routine.html"><span>üìÖ</span> Weekly Routine</a></li>
        <li><a href="student_attendance.html"><span>‚úÖ</span> Attendance</a></li>
        <li><a href="assignment.html"><span>üìù</span> Assignments</a></li>
        <li><a href="#" id="logoutBtn" class="btn">üö™ Logout</a></li>
      </ul>
    </aside>

    <main class="main-content">
      <div class="top-bar">
        <div class="welcome-section">
          <h1>Good Morning, Student üë©‚Äçüéì</h1>
          <p>Computer Science Department | Year 2025</p>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="stat-card">
          <div class="stat-icon">üìö</div>
          <h3>Total Courses</h3>
          <div class="number" id="totalCoursesCount">0</div>
          <div class="subtitle">Active This Semester</div>
        </div>
        <div class="stat-card">
          <div class="quick-actions">
            <h3>‚ö° Quick Actions</h3>
            <a href="#" class="quick-action-btn">üìÖ View Schedule</a>
            <a href="#" class="quick-action-btn">üìù Submit Assignment</a>
          </div>
        </div>
      </div>

      <!-- Today‚Äôs Schedule -->
      <section class="today-section">
        <h2><span>üåü</span> Today's Schedule - <span id="currentDate"></span></h2>
        <div class="today-classes" id="todayClasses"></div>
      </section>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const studentId = sessionStorage.getItem("studentId");
      const sessionValue = sessionStorage.getItem("session");

      if (!studentId || !sessionValue) return alert("Please login first!");

      // Set current date
      const today = new Date();
      const options = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
      document.getElementById("currentDate").textContent = today.toLocaleDateString("en-US", options);

      try {
        // 1Ô∏è‚É£ Total Courses for the student's session
        const resCourses = await fetch(`/api/student/${studentId}/courses/count?session=${sessionValue}`);
        const coursesData = await resCourses.json();
        document.getElementById("totalCoursesCount").textContent = coursesData.totalCourses || 0;

        // 2Ô∏è‚É£ Today‚Äôs Schedule
        const todayName = today.toLocaleDateString("en-US", { weekday: "long" });
        const resSchedule = await fetch(`/api/student/${studentId}/today-schedule?session=${sessionValue}&day=${todayName}`);
        const scheduleData = await resSchedule.json();

        const classes = Array.isArray(scheduleData.todayClasses) ? scheduleData.todayClasses : [];
        const container = document.getElementById("todayClasses");
        container.innerHTML = "";

        if (classes.length === 0) {
          container.innerHTML = `<div class="today-class-item">No classes scheduled for today!</div>`;
        } else {
          const nowMinutes = today.getHours() * 60 + today.getMinutes();

          classes.forEach((cls, index) => {
            const start = cls.start_time.split(":").map(Number);
            const end = cls.end_time.split(":").map(Number);
            const startMinutes = start[0]*60 + start[1];
            const endMinutes = end[0]*60 + end[1];

            let statusClass = "status-upcoming";
            let itemClass = "today-class-item";
            let statusText = "Upcoming";

            if (nowMinutes >= startMinutes && nowMinutes <= endMinutes) {
              statusClass = "status-current";
              itemClass += " current-class";
              statusText = "Current Class";
            } else if (index === 0 && nowMinutes < startMinutes) {
              statusClass = "status-next";
              itemClass += " next-class";
              statusText = "Next Class";
            }

            const div = document.createElement("div");
            div.className = itemClass;
            div.innerHTML = `
              <div class="class-time-today">${cls.start_time || "00:00"} - ${cls.end_time || "00:00"}</div>
              <div class="class-subject-today">${cls.course_name || "Unknown"}</div>
              <div class="class-room-today">üìç Room ${cls.room || "N/A"}</div>
              <div class="class-status ${statusClass}">${statusText}</div>
            `;
            container.appendChild(div);
          });
        }
      } catch (err) {
        console.error("Dashboard fetch error:", err);
        alert("Error fetching dashboard data!");
      }
    });

    document.getElementById("logoutBtn").addEventListener("click", function(e) {
      e.preventDefault();
      if (confirm("Are you sure you want to logout?")) {
        window.location.href = "#login";
      }
    });
  </script>
</body>
</html>
